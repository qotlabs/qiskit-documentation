<VirtualHost *:443>
    ServerName example.com
    DocumentRoot /srv/www/qiskit
    ServerAdmin webmaster@example.com
    ErrorLog ${APACHE_LOG_DIR}/qiskit_error.log
    CustomLog ${APACHE_LOG_DIR}/qiskit_access.log common

    <IfModule mod_ssl.c>
        SSLEngine on
        SSLCertificateFile /etc/letsencrypt/live/example.com/fullchain.pem
        SSLCertificateKeyFile /etc/letsencrypt/live/example.com/privkey.pem
    </IfModule>

    RewriteEngine on

    # Cache
    # Header set Cache-Control "public, max-age=86400, stale-while-revalidate=86400"
    # <IfModule mod_cache.c>
    #     CacheLock on
    #     CacheDisable /api/search
    #     CacheEnable disk /
    # </IfModule>

    # Static files served by Apache
    <Directory /srv/www/qiskit>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # Redirects
    <Proxy *>
        Redirect permanent /docs/tutorials/hello-world /docs/guides/hello-world
        Redirect permanent /guides /docs/guides
        Redirect permanent /responsible-quantum-computing /docs/responsible-quantum-computing
        Redirect permanent /faq /docs/guides/faq
        Redirect permanent /docs/guides/dynamic-circuits-considerations /docs/guides/job-limits
        Redirect permanent /docs/guides/map-problem-to-circuits /docs/guides/intro-to-patterns
        Redirect permanent /docs/guides/optimize-for-hardware /docs/guides/intro-to-patterns
        Redirect permanent /docs/guides/execute-on-hardware /docs/guides/intro-to-patterns
        Redirect permanent /docs/guides/post-process-results /docs/guides/intro-to-patterns
        Redirect permanent /docs/tutorials/variational-quantum-eigensolver /docs/tutorials/spin-chain-vqe
        RedirectMatch permanent ^/api/qiskit(.*) /docs/api/qiskit$1

        # 0.10 <= version <= 0.24
        RedirectMatch gone /docs/api/qiskit-ibm-runtime/0\.(1[0-9]|2[0-4])
        # 0.10 <= version <= 0.45
        RedirectMatch gone /docs/api/qiskit/0\.([1-3][0-9]|4[0-5])
        # 0.3 <= version <= 0.12
        RedirectMatch gone /docs/api/qiskit-ibm-transpiler/0\.([3-9]|1[0-2])
        RedirectMatch gone /docs/guides/transpile-rest-api

        # Archived migration guides
        Redirect permanent /docs/migration-guides/external-providers-primitives-v2 https://github.com/Qiskit/documentation/blob/2d2c2fcad47dd9e7ac1cc6807527dfccd796ea24/docs/migration-guides/external-providers-primitives-v2.mdx
        Redirect permanent /docs/migration-guides/qiskit-algorithms-module https://github.com/Qiskit/documentation/blob/2d2c2fcad47dd9e7ac1cc6807527dfccd796ea24/docs/migration-guides/qiskit-algorithms-module.mdx
        Redirect permanent /docs/migration-guides/qiskit-backend-primitives https://github.com/Qiskit/documentation/blob/2d2c2fcad47dd9e7ac1cc6807527dfccd796ea24/docs/migration-guides/qiskit-backend-primitives.mdx
        Redirect permanent /docs/migration-guides/qiskit-opflow-module https://github.com/Qiskit/documentation/blob/2d2c2fcad47dd9e7ac1cc6807527dfccd796ea24/docs/migration-guides/qiskit-opflow-module.mdx
        Redirect permanent /docs/migration-guides/qiskit-quantum-instance https://github.com/Qiskit/documentation/blob/2d2c2fcad47dd9e7ac1cc6807527dfccd796ea24/docs/migration-guides/qiskit-quantum-instance.mdx
        Redirect permanent /docs/migration-guides/qiskit-runtime-examples https://github.com/Qiskit/documentation/blob/2d2c2fcad47dd9e7ac1cc6807527dfccd796ea24/docs/migration-guides/qiskit-runtime-examples.mdx
        Redirect permanent /docs/migration-guides/qiskit-runtime-from-ibm-provider https://github.com/Qiskit/documentation/blob/2d2c2fcad47dd9e7ac1cc6807527dfccd796ea24/docs/migration-guides/qiskit-runtime-from-ibm-provider.mdx
        Redirect permanent /docs/migration-guides/qiskit-runtime-from-ibmq-provider https://github.com/Qiskit/documentation/blob/2d2c2fcad47dd9e7ac1cc6807527dfccd796ea24/docs/migration-guides/qiskit-runtime-from-ibmq-provider.mdx
        Redirect permanent /docs/migration-guides/qiskit-runtime-options https://github.com/Qiskit/documentation/blob/2d2c2fcad47dd9e7ac1cc6807527dfccd796ea24/docs/migration-guides/qiskit-runtime-options.mdx
        Redirect permanent /docs/migration-guides/qiskit-runtime-use-case https://github.com/Qiskit/documentation/blob/2d2c2fcad47dd9e7ac1cc6807527dfccd796ea24/docs/migration-guides/qiskit-runtime-use-case.mdx
        Redirect permanent /docs/migration-guides/qiskit-runtime https://github.com/Qiskit/documentation/blob/2d2c2fcad47dd9e7ac1cc6807527dfccd796ea24/docs/migration-guides/qiskit-runtime.mdx

        Redirect permanent /docs/migration-guides /docs/guides
        Redirect permanent /docs/open-source/ /docs/guides/
        Redirect permanent /docs/open-source /docs/guides/open-source
        Redirect permanent /docs/support/ /docs/guides/
        Redirect permanent /docs/support /docs/guides/support
        Redirect permanent /docs/security/ /docs/guides/
        Redirect permanent /docs/security /docs/guides/secure-data
        Redirect permanent /docs/guides/pulse /docs/guides/pulse-migration
    </Proxy>

    # Qiskit search
    ProxyPass /api/search http://127.0.0.1:9193/api/search
    ProxyPassReverse /api/search http://127.0.0.1:9193/api/search

    # Qiskit documentation
    RewriteRule ^/?$ /docs/index [QSA,PT]
    RewriteRule ^/learning$ /learning/index [QSA,PT]
    ProxyPass /410.html !
    ProxyPass / http://127.0.0.1:9192/
    ProxyPassReverse / http://127.0.0.1:9192/
    ErrorDocument 410 /410.html
</VirtualHost>

<VirtualHost *:80>
    ServerName example.com
    RedirectPermanent / https://example.com/
</VirtualHost>
