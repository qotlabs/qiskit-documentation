<VirtualHost *:443>
    ServerName example.com
    DocumentRoot /srv/www
    ServerAdmin webmaster@example.com
    ErrorLog ${APACHE_LOG_DIR}/qiskit_error.log
    CustomLog ${APACHE_LOG_DIR}/qiskit_access.log common

    <IfModule mod_ssl.c>
        SSLEngine on
        SSLCertificateFile /etc/letsencrypt/live/example.com/fullchain.pem
        SSLCertificateKeyFile /etc/letsencrypt/live/example.com/privkey.pem
    </IfModule>

    RewriteEngine on

    # Cache
    Header set Cache-Control "public, max-age=86400, stale-while-revalidate=86400"
    <IfModule mod_cache.c>
        CacheLock on
        CacheDisable /api/search
        CacheEnable disk /
    </IfModule>

    # Redirects
    <Proxy *>
        Redirect permanent /guides/hello-world /docs/tutorials/hello-world
        Redirect permanent /guides/execution-modes-faq /docs/support/execution-modes-faq
        Redirect permanent /guides /docs/guides
        Redirect permanent /migration-guides /docs/migration-guides
        Redirect permanent /open-source /docs/open-source
        Redirect permanent /responsible-quantum-computing /docs/responsible-quantum-computing
        Redirect permanent /faq /docs/support/faq
        Redirect permanent /docs/guides/dynamic-circuits-considerations /docs/guides/job-limits
        Redirect permanent /docs/tutorials/variational-quantum-eigensolver /docs/tutorials/spin-chain-vqe
        RedirectMatch permanent ^/api/qiskit(.*) /docs/api/qiskit$1

        # 0.10 <= version <= 0.24
        RedirectMatch gone /docs/api/qiskit-ibm-runtime/0\.(1[0-9]|2[0-4])
        # 0.10 <= version <= 0.45
        RedirectMatch gone /docs/api/qiskit/0\.([1-3][0-9]|4[0-5])
    </Proxy>

    # Qiskit search
    ProxyPass /api/search http://127.0.0.1:9193/api/search
    ProxyPassReverse /api/search http://127.0.0.1:9193/api/search

    # Qiskit documentation
    RewriteRule ^/?$ /docs/index [QSA,PT]
    RewriteRule ^/learning$ /learning/index [QSA,PT]
    ProxyPass / http://127.0.0.1:9192/
    ProxyPassReverse / http://127.0.0.1:9192/
    #ErrorDocument 410 /docs/410
</VirtualHost>

<VirtualHost *:80>
    ServerName example.com
    RedirectPermanent / https://example.com/
</VirtualHost>
